var $doc=$(document),$win=$(window),FrameView=Backbone.View.extend({navTo:function(){rootApp.navigate=!0;var t=this.$el.offset().top;$("body").animate({scrollTop:t},"fast",function(){rootApp.navigate=!1,rootApp.prevScrollTop=$doc.scrollTop(),$win.trigger("scroll")})},correct:function(){var t=this.$el.outerHeight()-58,o=this.$el.find(".wrapper").height();this.$el.find(".wrapper").css({marginTop:t>o+50?(t-o)/2:25})}}),App=Backbone.View.extend({el:"body",navigate:!1,frames:{},currentFrame:0,events:{"click .nav-button":"navButton"},navButton:function(t){var o=$(t.target);this.navTo(o.data("frame"))},initialize:function(){this.prepare(["welcome","promo","catalogue","works","tech","footer"]),this.frames.welcome.correct=function(){return!0},this.frames.footer.correct=function(){var t=this.$el.height();this.$el.find("h2").css({marginTop:t>750?(t-700)/2:25})},_.bindAll(this,"onScroll","navCorrectPos"),$(window).scroll(this.onScroll).resize(this.navCorrectPos),this.navCorrectPos()},prepare:function(t){this.$panel=$('<div class="nav-panel">'),_.each(t,function(t,o){this.frames[t]=new FrameView({el:"#"+t,index:o}),this.$panel.append($('<div class="nav-button" data-frame="'+t+'">'))},this),this.$panel.find(".nav-button").eq(0).addClass("current"),this.$el.append(this.$panel),this.prevScrollTop=$(document).scrollTop()},onScroll:function(){var t=$doc.scrollTop(),o=_.find(this.frames,function(o){return Math.floor(t)==Math.floor(o.$el.offset().top)}),e=t-this.prevScrollTop;this.navigate||o||this.navToScroll(e),o&&$(".nav-button[data-frame="+o.$el.prop("id")+"]").addClass("current").siblings().removeClass("current")},navCorrectPos:function(){_.each(this.frames,function(t){t.correct()}),this.$panel.css({top:($(window).height()-this.$panel.height())/2})},navTo:function(t){this.frames[t].navTo()},navToScroll:function(t){{var o=$win.height();Math.floor((t-o/2)/o)}}});$(document).ready(function(){rootApp=new App});