var FrameView=Backbone.View.extend({dark:!1,initialize:function(e){this.index=e.index,e.dark&&(this.dark=!0),e.onScroll&&(this.onScroll=e.onScroll),e.onResize&&(this.onResize=e.onResize),_.bindAll(this,"onScroll","onResize"),$(window).scroll(this.onScroll).resize(this.onResize),this.onResize()},navTo:function(){rootApp.navigate=!0;var e=this.$el.css("top"),t=this.$el.offset().top-("auto"!=e?parseInt(e):0);$("body").animate({scrollTop:t},1e3,function(){rootApp.navigate=!1,rootApp.prevScrollTop=$doc.scrollTop(),$win.trigger("scroll")})},onScroll:function(){return this},onResize:function(){var e=this.$el.outerHeight()-58,t=this.$el.find(".wrapper").height();return this.$el.find(".wrapper").css({marginTop:e>t+50?(e-t)/2:25}),this}}),App=Backbone.View.extend({el:"body",navigate:!1,frames:{},currentFrame:0,events:{"click .nav-button":"navButton"},navButton:function(e){var t=$(e.target);this.navTo(t.data("frame"))},initialize:function(e){this.prepare(e),_.bindAll(this,"onScroll","navCorrectPos"),$(window).scroll(this.onScroll).resize(this.navCorrectPos),this.navCorrectPos()},prepare:function(e){var t=0;this.$panel=$('<div class="nav-panel">'),_.each(e,function(e,n){this.frames[n]=new FrameView($.extend(!0,{el:"#"+n,index:t},e)),this.$panel.append($('<div class="nav-button" data-frame="'+n+'">')),t++},this),this.$panel.find(".nav-button").data("app",this).eq(0).addClass("current"),this.$el.append(this.$panel),this.prevScrollTop=$(document).scrollTop()},onScroll:function(){var e=$doc.scrollTop();this.$panel.find(".nav-button").each(function(){var e=$(this),t=e.offset().top+e.height()/2,n=e.data("app").getFrameByPos(t);e.toggleClass("inverted",n.dark)}).removeClass("current").eq(this.getFrameByPos(e+$win.height()/2).index).addClass("current")},navCorrectPos:function(){this.$panel.css({top:($(window).height()-this.$panel.height())/2}),$win.trigger("scroll")},navTo:function(e){this.frames[e].navTo()},navToScroll:function(e){{var t=$win.height();Math.floor((e-t/2)/t)}},getFrameByPos:function(e){return _.find(this.frames,function(t){var n=parseInt(t.$el.css("top")),o=t.$el.offset().top-(n?n:0);return e>o&&o+t.$el.outerHeight()>e})}});$(document).ready(function(){rootApp=new App(framesJSON),$win.trigger("scroll")});