var FrameView=Backbone.View.extend({dark:!1,initialize:function(t){this.index=t.index,t.dark&&(this.dark=!0),t.onScroll&&(this.onScroll=t.onScroll),t.onResize&&(this.onResize=t.onResize),_.bindAll(this,"onScroll","onResize"),$(window).scroll(this.onScroll).resize(this.onResize),this.onResize()},navTo:function(t){var e=this.$el.css("top"),n=this.$el.offset().top-("auto"!=e?parseInt(e):0);$("html, body").animate({scrollTop:n},1e3,function(){$win.trigger("scroll"),t&&t()})},onScroll:function(){return this},onResize:function(){var t=this.$el.outerHeight()-58,e=this.$el.find(".wrapper").height();return this.$el.find(".wrapper").css({marginTop:t>e+50?(t-e)/2:25}),this}}),App=Backbone.View.extend({el:"body",navigate:!1,frames:{},currentFrame:"",verticalStep:30,events:{"click .nav-button":"navButton",mousewheel:"wheelNav",keydown:"keyNav"},navButton:function(t){var e=$(t.target);this.navTo(e.data("frame"))},keyNav:function(t){this.navigate||(38==t.keyCode?this.verticalNav(-1):40==t.keyCode&&this.verticalNav(1))},wheelNav:function(t){this.navigate||this.verticalNav(-t.deltaY)},initialize:function(t){this.prepare(t),_.bindAll(this,"onScroll","navCorrectPos"),$(window).scroll(this.onScroll).resize(this.navCorrectPos),this.navCorrectPos()},prepare:function(t){var e=0;this.$panel=$('<div class="nav-panel">'),_.each(t,function(t,n){this.currentFrame||(this.currentFrame=n),this.frames[n]=new FrameView($.extend(!0,{el:"#"+n,index:e},t)),this.$panel.append($('<div class="nav-button" data-frame="'+n+'">')),e++},this),this.currentFrame=this.$panel.find(".nav-button").data("app",this).eq(0).addClass("current").data("frame"),this.$el.append(this.$panel)},onScroll:function(){var t=$doc.scrollTop();this.currentFrame=this.$panel.find(".nav-button").each(function(){var t=$(this),e=t.offset().top+t.height()/2,n=t.data("app").getFrameByPos(e);t.toggleClass("inverted",n.dark)}).removeClass("current").eq(this.getFrameByPos(t+$win.height()/2).index).addClass("current").data("frame")},navCorrectPos:function(){this.$panel.css({top:($(window).height()-this.$panel.height())/2}),$win.trigger("scroll")},navTo:function(t){this.navigate=!0,$win.data("rootApp").currentFrame=t,this.frames[t].navTo(function(){$win.data("rootApp").navigate=!1,document.location.href="#"+t})},verticalNav:function(t){var e=this.getSiblingFrame(t),n=$doc.scrollTop(),i=this.frames[this.currentFrame].$el.offset().top;this.checkShift(t)?$doc.scrollTop(n+this.verticalStep*t):0>t&&n>i+1&&n<i+this.verticalStep+1?this.navTo(this.currentFrame):e&&this.navTo(this.getSiblingFrame(t))},checkShift:function(t){var e=$doc.scrollTop()+this.verticalStep*t,n=this.frames[this.currentFrame].$el.offset().top;return e>n+1&&e+$win.height()<n+this.frames[this.currentFrame].$el.outerHeight()},getFrameByPos:function(t){return _.find(this.frames,function(e){var n=parseInt(e.$el.css("top")),i=e.$el.offset().top-(n?n:0);return t>i&&i+e.$el.outerHeight()>t})},getSiblingFrame:function(t){var e,n=this.$panel.find(".nav-button[data-frame="+this.currentFrame+"]");return e=0>t?n.prev(".nav-button"):n.next(".nav-button"),e.length?e.data("frame"):!1}});$(document).ready(function(){$win.data("rootApp",new App(framesJSON)),$win.trigger("scroll")});